# ‚úÖ –û—Ç—á–µ—Ç –æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∑–∞—è–≤–æ–∫

**–î–∞—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** 2025-11-09
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
**–í–∞—Ä–∏–∞–Ω—Ç:** –í–∞—Ä–∏–∞–Ω—Ç 1 (–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∫–ª–∞–¥–∫–∏-—Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

**–§–∞–π–ª:** `/frontend/src/pages/MaterialRequests.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç Tabs** (—Å—Ç—Ä–æ–∫–∞ 2):
   ```tsx
   import { Tabs } from 'antd';
   const { TabPane } = Tabs;
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∏ 50-61):
   ```tsx
   const IN_PROGRESS_STATUSES = [
     'UNDER_REVIEW', 'WAREHOUSE_CHECK', 'BACK_TO_SUPPLY',
     'ENGINEER_APPROVAL', 'BACK_TO_SUPPLY_AFTER_ENGINEER',
     'PROJECT_MANAGER_APPROVAL', 'BACK_TO_SUPPLY_AFTER_PM',
     'DIRECTOR_APPROVAL', 'RETURNED_FOR_REVISION'
   ];

   const APPROVED_STATUSES = [
     'BACK_TO_SUPPLY_AFTER_DIRECTOR', 'APPROVED',
     'PAYMENT', 'PAID', 'DELIVERY'
   ];
   ```

3. **–î–æ–±–∞–≤–ª–µ–Ω state –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏** (—Å—Ç—Ä–æ–∫–∞ 72):
   ```tsx
   const [activeTab, setActiveTab] = useState('all');
   ```

4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∏ 659-677):
   ```tsx
   const getFilteredData = (data: FlatMaterialRow[]) => {
     return data.filter(row => {
       const status = row.material?.item_status;
       const actual = row.material?.actual_quantity || 0;
       const requested = row.material?.quantity || 0;

       if (activeTab === 'in_progress') {
         return IN_PROGRESS_STATUSES.includes(status);
       }
       if (activeTab === 'approved') {
         return APPROVED_STATUSES.includes(status) && actual < requested;
       }
       if (activeTab === 'completed') {
         return status === 'COMPLETED' || actual >= requested;
       }
       return true; // all
     });
   };
   ```

5. **–¢–∞–±–ª–∏—Ü–∞ –æ–±–µ—Ä–Ω—É—Ç–∞ –≤ Tabs** (—Å—Ç—Ä–æ–∫–∏ 1582-1709):
   - –í–∫–ª–∞–¥–∫–∞ "–í—Å–µ –∑–∞—è–≤–∫–∏" (key="all")
   - –í–∫–ª–∞–¥–∫–∞ "–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏" (key="in_progress")
   - –í–∫–ª–∞–¥–∫–∞ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" (key="approved") —Å —Å—á–µ—Ç—á–∏–∫–æ–º
   - –í–∫–ª–∞–¥–∫–∞ "–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" (key="completed")

6. **–£–¥–∞–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∏ 1502-1515):
   - –£–±—Ä–∞–Ω—ã –∫–Ω–æ–ø–∫–∏ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" –∏ "–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"
   - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –≤–∫–ª–∞–¥–∫–∏

---

### ‚úÖ 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–Ω–æ–ø–∫–µ "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"

**–§–∞–π–ª:** `/frontend/src/pages/MaterialRequests.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è canAcceptOnSite()** (—Å—Ç—Ä–æ–∫–∏ 1431-1439):
   ```tsx
   const canAcceptOnSite = () => {
     if (user?.is_superuser || user?.role === 'SUPERADMIN') {
       return true;
     }
     // –¢–æ–ª—å–∫–æ: –ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞, –ü—Ä–æ—Ä–∞–±, –ú–∞—Å—Ç–µ—Ä, –ó–∞–≤—Å–∫–ª–∞–¥ –æ–±—ä–µ–∫—Ç–∞
     const allowedRoles = ['SITE_MANAGER', 'FOREMAN', 'MASTER', 'SITE_WAREHOUSE_MANAGER'];
     return allowedRoles.includes(user?.role || '');
   };
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ DELIVERY** (—Å—Ç—Ä–æ–∫–∏ 1206-1217):
   ```tsx
   {itemStatus === 'DELIVERY' && canAcceptOnSite() && !isCancelled && record.material && (
     <Button
       type="primary"
       icon={<CheckOutlined />}
       size="small"
       onClick={() => handleChangeItemStatus(record.material, 'COMPLETED', '–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ', '–ü—Ä–∏–µ–º –Ω–∞ –æ–±—ä–µ–∫—Ç–µ...', '–ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ')}
       block
     >
       –ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
     </Button>
   )}
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ WAREHOUSE_SHIPPING** (—Å—Ç—Ä–æ–∫–∏ 1232-1243):
   ```tsx
   {itemStatus === 'WAREHOUSE_SHIPPING' && canAcceptOnSite() && !isCancelled && record.material && (
     <Button
       type="primary"
       icon={<CheckOutlined />}
       size="small"
       onClick={() => handleChangeItemStatus(record.material, 'COMPLETED', '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∏–Ω—è—Ç—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–µ –∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω—ã', '–ü—Ä–∏–µ–º–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...', '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∏–Ω—è—Ç—ã –∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω—ã')}
       block
     >
       –ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
     </Button>
   )}
   ```

**–î–æ—Å—Ç—É–ø –∫ –∫–Ω–æ–ø–∫–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –¢–û–õ–¨–ö–û:**
- SUPERADMIN
- SITE_MANAGER (–ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞)
- FOREMAN (–ü—Ä–æ—Ä–∞–±)
- MASTER (–ú–∞—Å—Ç–µ—Ä)
- SITE_WAREHOUSE_MANAGER (–ó–∞–≤—Å–∫–ª–∞–¥ –æ–±—ä–µ–∫—Ç–∞)

---

### ‚úÖ 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ actual_quantity –Ω–∞ backend

**–§–∞–π–ª:** `/backend/apps/material_requests/views.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ —Å—Ç–∞—Ç—É—Å COMPLETED (—Å—Ç—Ä–æ–∫–∏ 935-951):

```python
# –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ COMPLETED
if new_status == 'COMPLETED':
    actual = item.actual_quantity or 0
    requested = item.quantity

    if actual < requested:
        missing = requested - actual
        return Response({
            'detail': (
                f'–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é: –ø–æ —Ñ–∞–∫—Ç—É –ø–æ–ª—É—á–µ–Ω–æ {actual} {item.unit}, '
                f'–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–æ {requested} {item.unit}. '
                f'–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –µ—â–µ {missing} {item.unit}.'
            ),
            'actual_quantity': float(actual),
            'requested_quantity': float(requested),
            'missing_quantity': float(missing)
        }, status=status.HTTP_400_BAD_REQUEST)
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏—é –≤ —Å—Ç–∞—Ç—É—Å `COMPLETED`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è: `actual_quantity >= quantity`
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 400 —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –ü–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ (`DELIVERY` –∏–ª–∏ `WAREHOUSE_SHIPPING`)

---

### ‚úÖ 4. Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

```bash
docker compose restart backend
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Backend —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

‚ùå **–ü—Ä–æ–±–ª–µ–º—ã:**
1. –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
2. –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"
3. –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ" –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –ò–¢–† (7 —Ä–æ–ª–µ–π)
4. –ü–æ–∑–∏—Ü–∏—è –º–æ–≥–ª–∞ –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–∞–∂–µ –µ—Å–ª–∏ `actual_quantity < quantity`

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

‚úÖ **–†–µ—à–µ–Ω–∏—è:**

1. **4 –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
   - **–í—Å–µ –∑–∞—è–≤–∫–∏** ‚Äî –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞
   - **–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏** ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –¥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∞
   - **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏** ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ –î–∏—Ä–µ–∫—Ç–æ—Ä–∞ —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π (actual < quantity)
   - **–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏** ‚Äî COMPLETED –∏–ª–∏ actual >= quantity

2. **–°—á–µ—Ç—á–∏–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏":**
   - –ó–µ–ª–µ–Ω—ã–π Tag —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–∑–∏—Ü–∏–π
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ":**
   - –¢–æ–ª—å–∫–æ 4 —Ä–æ–ª–∏: SITE_MANAGER, FOREMAN, MASTER, SITE_WAREHOUSE_MANAGER
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ò–¢–† –Ω–µ –≤–∏–¥—è—Ç —ç—Ç—É –∫–Ω–æ–ø–∫—É

4. **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:**
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π
   - –ü–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç –≤ —Å—Ç–∞—Ç—É—Å –æ–∂–∏–¥–∞–Ω–∏—è

---

## üéØ –ù–æ–≤—ã–π Workflow

### –ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∞:

```
–î–∏—Ä–µ–∫—Ç–æ—Ä —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç
         ‚Üì
BACK_TO_SUPPLY_AFTER_DIRECTOR
         ‚Üì
    –°–Ω–∞–±–∂–µ–Ω–µ—Ü –≤—ã–±–∏—Ä–∞–µ—Ç –ø—É—Ç—å:
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–£–¢–¨ 1: –ó–∞–∫—É–ø–∫–∞       ‚îÇ  –ü–£–¢–¨ 2: –°–æ —Å–∫–ª–∞–¥–∞     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. PAYMENT (–ù–∞ –æ–ø–ª–∞—Ç–µ)‚îÇ  1. SENT_TO_SITE       ‚îÇ
‚îÇ  2. PAID (–û–ø–ª–∞—á–µ–Ω–æ)    ‚îÇ  2. WAREHOUSE_SHIPPING ‚îÇ
‚îÇ  3. DELIVERY           ‚îÇ                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì                          ‚Üì
    –ò–¢–† –Ω–∞ –æ–±—ä–µ–∫—Ç–µ –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"
         ‚Üì
    ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: actual_quantity >= quantity?
         ‚Üì
    –î–ê ‚Üí COMPLETED (–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏)
         ‚Üì
    –ù–ï–¢ ‚Üí –û—à–∏–±–∫–∞ + –ø–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö"
```

---

## üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º

### –í–∫–ª–∞–¥–∫–∞ "–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏"

**–£—Å–ª–æ–≤–∏–µ:**
```typescript
item_status IN [
  'UNDER_REVIEW',
  'WAREHOUSE_CHECK',
  'BACK_TO_SUPPLY',
  'ENGINEER_APPROVAL',
  'BACK_TO_SUPPLY_AFTER_ENGINEER',
  'PROJECT_MANAGER_APPROVAL',
  'BACK_TO_SUPPLY_AFTER_PM',
  'DIRECTOR_APPROVAL',
  'RETURNED_FOR_REVISION'
]
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–∏—Ü–∏–∏, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —Ü–µ–ø–æ—á–∫—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (–¥–æ –î–∏—Ä–µ–∫—Ç–æ—Ä–∞)

---

### –í–∫–ª–∞–¥–∫–∞ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" ‚≠ê

**–£—Å–ª–æ–≤–∏–µ:**
```typescript
item_status IN [
  'BACK_TO_SUPPLY_AFTER_DIRECTOR',
  'APPROVED',
  'PAYMENT',
  'PAID',
  'DELIVERY'
]
AND
actual_quantity < quantity
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∞, –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–∑–∏—Ü–∏–π

---

### –í–∫–ª–∞–¥–∫–∞ "–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"

**–£—Å–ª–æ–≤–∏–µ:**
```typescript
item_status = 'COMPLETED'
OR
actual_quantity >= quantity
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–∏—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ (–ª–∏–±–æ –ø–æ —Å—Ç–∞—Ç—É—Å—É, –ª–∏–±–æ –ø–æ —Ñ–∞–∫—Ç—É)

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Frontend:

1. `/frontend/src/pages/MaterialRequests.tsx`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã Tabs
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   - –î–æ–±–∞–≤–ª–µ–Ω state activeTab
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getFilteredData()
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è canAcceptOnSite()
   - –¢–∞–±–ª–∏—Ü–∞ –æ–±–µ—Ä–Ω—É—Ç–∞ –≤ Tabs
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ DELIVERY –∏ WAREHOUSE_SHIPPING

### Backend:

1. `/backend/apps/material_requests/views.py`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ actual_quantity –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ COMPLETED
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ —Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

**–®–∞–≥–∏:**
1. –ó–∞–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/dashboard/material-requests`
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –í–∫–ª–∞–¥–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –°—á–µ—Ç—á–∏–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–Ω–æ–ø–∫–µ

**–®–∞–≥–∏:**
1. –ó–∞–π—Ç–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–æ–ª–∏ ENGINEER (–ò–Ω–∂–µ–Ω–µ—Ä –ü–¢–û)
2. –û—Ç–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DELIVERY
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –ö–Ω–æ–ø–∫–∞ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–ª—è ENGINEER
‚úÖ –ö–Ω–æ–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è: SITE_MANAGER, FOREMAN, MASTER, SITE_WAREHOUSE_MANAGER

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ actual_quantity

**–®–∞–≥–∏:**
1. –ó–∞–π—Ç–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–æ–ª–∏ FOREMAN (–ü—Ä–æ—Ä–∞–±)
2. –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ 10 —à—Ç. –º–∞—Ç–µ—Ä–∏–∞–ª–∞
3. –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ –≤—Å–µ—Ö (–¥–æ –î–∏—Ä–µ–∫—Ç–æ—Ä–∞)
4. –°–Ω–∞–±–∂–µ–Ω–µ—Ü –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É ‚Üí –æ–ø–ª–∞—á–µ–Ω–æ ‚Üí –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
5. –£–∫–∞–∑–∞—Ç—å actual_quantity = 7 (–º–µ–Ω—å—à–µ 10)
6. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞–∂–∞—Ç—å "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 400
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é: –ø–æ —Ñ–∞–∫—Ç—É –ø–æ–ª—É—á–µ–Ω–æ 7 —à—Ç, –∞ –∑–∞–ø—Ä–æ—à–µ–Ω–æ 10 —à—Ç. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –µ—â–µ 3 —à—Ç."
‚úÖ –ü–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ DELIVERY
‚úÖ –ü–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**–®–∞–≥–∏:**
1. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
2. –û–±–Ω–æ–≤–∏—Ç—å actual_quantity = 10 (–∏–ª–∏ –±–æ–ª—å—à–µ)
3. –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –ü–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å COMPLETED
‚úÖ –ü–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"
‚úÖ –°—á–µ—Ç—á–∏–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–Ω—è–ª–∞ 2 —á–∞—Å–∞
2. ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ë–î** ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
3. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî —Å—Ç–∞—Ä—ã–µ –∑–∞—è–≤–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
4. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π UX** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
5. ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—è–≤–∫—É —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π
6. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –°–Ω–∞–±–∂–µ–Ω—Ü—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π
   - Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ

2. **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤–æ–∫:**
   - –õ–æ–≥ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π actual_quantity
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é: "–ü–µ—Ä–≤–∞—è –ø–∞—Ä—Ç–∏—è 3—Ç, –≤—Ç–æ—Ä–∞—è 5—Ç, –∏—Ç–æ–≥–æ 8—Ç"

3. **–ê–≤—Ç–æ–≤–æ–∑–≤—Ä–∞—Ç:**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ BACK_TO_SUPPLY_AFTER_DIRECTOR
   - –î–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∏—Å—Ç–æ—Ä–∏—é

4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
   - –û—Ç—á–µ—Ç –ø–æ –Ω–µ–¥–æ—Å—Ç–∞—á–∞–º
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞—è–≤–æ–∫

---

## ‚úÖ –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∫–ª–∞–¥–∫–∏-—Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
- [x] –û–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–Ω–æ–ø–∫–µ "–ü—Ä–∏–Ω—è—Ç–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ actual_quantity –Ω–∞ backend
- [x] Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ (–≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 2025-11-09
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~2 —á–∞—Å–∞
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- `/MATERIAL_REQUESTS_NEW_LOGIC_PROPOSAL.md` ‚Äî –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
- `/MATERIAL_REQUESTS_APPROVAL_FLOW.md` ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è workflow
- `/BUG_SUPPLY_MANAGER_PAYMENT.md` ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–∞–≥ —Å –ø—Ä—è–º—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏

# Generated by Django 4.2.16 on 2025-11-06 15:06

from django.db import migrations


def update_delete_buttons(apps, schema_editor):
    """
    –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É 'delete' –¥–ª—è users, contractors, supervisions:
    –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–ª—å SITE_MANAGER (–Ω–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞) –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–∞–≤–∞–º –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ.

    –¢–µ–ø–µ—Ä—å —É–¥–∞–ª—è—Ç—å –º–æ–≥—É—Ç:
    - SUPERADMIN, DIRECTOR, CHIEF_ENGINEER, PROJECT_MANAGER, SITE_MANAGER
    """
    ButtonAccess = apps.get_model('core', 'ButtonAccess')

    pages = ['users', 'contractors', 'supervisions']

    for page in pages:
        try:
            delete_button = ButtonAccess.objects.get(
                page=page,
                button_key='delete',
                access_type='button',
                company__isnull=True
            )

            # –î–æ–±–∞–≤–ª—è–µ–º SITE_MANAGER –∫ –ø—Ä–∞–≤–∞–º –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
            delete_button.SITE_MANAGER = True
            delete_button.save(update_fields=['SITE_MANAGER'])

            print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ delete –¥–ª—è {page}: –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å SITE_MANAGER")
        except ButtonAccess.DoesNotExist:
            print(f"‚ö†Ô∏è  –ö–Ω–æ–ø–∫–∞ delete –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è {page}")


def revert_delete_buttons(apps, schema_editor):
    """–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ - —É–±–∏—Ä–∞–µ–º SITE_MANAGER –∏–∑ –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ."""
    ButtonAccess = apps.get_model('core', 'ButtonAccess')

    pages = ['users', 'contractors', 'supervisions']

    for page in pages:
        try:
            delete_button = ButtonAccess.objects.get(
                page=page,
                button_key='delete',
                access_type='button',
                company__isnull=True
            )

            # –£–±–∏—Ä–∞–µ–º SITE_MANAGER –∏–∑ –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
            delete_button.SITE_MANAGER = False
            delete_button.save(update_fields=['SITE_MANAGER'])

            print(f"üîÑ –û—Ç–∫–∞—Ç: —É–±—Ä–∞–Ω–∞ —Ä–æ–ª—å SITE_MANAGER –∏–∑ –∫–Ω–æ–ø–∫–∏ delete –¥–ª—è {page}")
        except ButtonAccess.DoesNotExist:
            print(f"‚ö†Ô∏è  –ö–Ω–æ–ø–∫–∞ delete –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è {page}")


class Migration(migrations.Migration):

    dependencies = [
        ("core", "0005_add_missing_user_management_buttons"),
    ]

    operations = [
        migrations.RunPython(update_delete_buttons, revert_delete_buttons),
    ]

# Material Requests API - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –ø–æ—ç—Ç–∞–ø–Ω—ã–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ–º.

**–ë–∞–∑–æ–≤—ã–π URL:** `/api/material-requests/`

---

## –ú–æ–¥–µ–ª–∏

### MaterialRequest (–ó–∞—è–≤–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã)

–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∑–∞—è–≤–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–æ–º–µ—Ä–æ–º (MR-2024-0001) –∏ –ø–æ—ç—Ç–∞–ø–Ω—ã–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ–º.

**–ü–æ–ª—è:**
- `id` - ID –∑–∞—è–≤–∫–∏
- `number` - –ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏ (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- `company` - –ö–æ–º–ø–∞–Ω–∏—è (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `project` - –ü—Ä–æ–µ–∫—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `created_by` - –ê–≤—Ç–æ—Ä –∑–∞—è–≤–∫–∏
- `status` - –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
- `current_approver_role` - –†–æ–ª—å —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–≥–ª–∞—Å—É—é—â–µ–≥–æ
- `current_approver` - –¢–µ–∫—É—â–∏–π —Å–æ–≥–ª–∞—Å—É—é—â–∏–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- `approval_chain` - –¶–µ–ø–æ—á–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (JSON)
- `approval_history` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (JSON)
- `items` - –ü–æ–∑–∏—Ü–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏: `created_at`, `submitted_at`, `approved_at`, `completed_at`

**–°—Ç–∞—Ç—É—Å—ã:**
1. `DRAFT` - –ß–µ—Ä–Ω–æ–≤–∏–∫
2. `SITE_MANAGER_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –ù–∞—á–∞–ª—å–Ω–∏–∫–∞ —É—á–∞—Å—Ç–∫–∞
3. `ENGINEER_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ü–¢–û
4. `PM_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø—Ä–æ–µ–∫—Ç–∞
5. `CHIEF_POWER_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –ì–ª–∞–≤–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞
6. `CHIEF_ENGINEER_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –ì–ª–∞–≤–Ω–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞
7. `DIRECTOR_APPROVAL` - –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –î–∏—Ä–µ–∫—Ç–æ—Ä–∞
8. `APPROVED` - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ
9. `WAREHOUSE_REVIEW` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ
10. `PROCUREMENT` - –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
11. `PAYMENT` - –ù–∞ –æ–ø–ª–∞—Ç–µ
12. `DELIVERY` - –ù–∞ –¥–æ—Å—Ç–∞–≤–∫–µ
13. `COMPLETED` - –û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ –∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
14. `REJECTED` - –í–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

### MaterialRequestItem (–ü–æ–∑–∏—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞)

**–ü–æ–ª—è:**
- `id` - ID –ø–æ–∑–∏—Ü–∏–∏
- `material_name` - –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- `unit` - –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–º, –º2, –º3, —à—Ç, –∫–≥, —Ç, –ª)
- `quantity_requested` - –ó–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- `quantity_actual` - –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–∏—ë–º–∫–µ)
- `notes` - –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- `order` - –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

## API Endpoints

### 1. –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫

**GET** `/api/material-requests/requests/`

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
- `?status=DRAFT` - –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `?project=1` - –ø–æ –ø—Ä–æ–µ–∫—Ç—É
- `?created_by=5` - –ø–æ –∞–≤—Ç–æ—Ä—É
- `?search=MR-2024` - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç—É

**–û—Ç–≤–µ—Ç (—Å–ø–∏—Å–æ–∫):**
```json
{
  "count": 10,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": 1,
      "number": "MR-2024-0001",
      "project": {...},
      "created_by": {...},
      "status": "DRAFT",
      "status_display": "–ß–µ—Ä–Ω–æ–≤–∏–∫",
      "current_approver_role": null,
      "items_count": 5,
      "created_at": "2024-11-11T10:00:00Z",
      "submitted_at": null
    }
  ]
}
```

---

### 2. –î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏

**GET** `/api/material-requests/requests/{id}/`

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "number": "MR-2024-0001",
  "company": {...},
  "project": {...},
  "created_by": {...},
  "status": "PM_APPROVAL",
  "status_display": "–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø—Ä–æ–µ–∫—Ç–∞",
  "current_approver_role": "PROJECT_MANAGER",
  "current_approver": {...},
  "approval_chain": ["SITE_MANAGER", "ENGINEER", "PROJECT_MANAGER", "DIRECTOR"],
  "approval_chain_index": 2,
  "approval_history": [
    {
      "role": "SITE_MANAGER",
      "approver": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
      "decision": "approved",
      "date": "2024-11-11T11:00:00Z",
      "comment": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ"
    }
  ],
  "items": [
    {
      "id": 1,
      "material_name": "–¶–µ–º–µ–Ω—Ç –ú500",
      "unit": "—Ç",
      "quantity_requested": "5.000",
      "quantity_actual": null,
      "notes": "–î–ª—è –∑–∞–ª–∏–≤–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞",
      "order": 0
    }
  ],
  "created_at": "2024-11-11T10:00:00Z",
  "submitted_at": "2024-11-11T10:30:00Z"
}
```

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (—á–µ—Ä–Ω–æ–≤–∏–∫)

**POST** `/api/material-requests/requests/`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "project_id": 1,
  "items_data": [
    {
      "material_name": "–¶–µ–º–µ–Ω—Ç –ú500",
      "unit": "—Ç",
      "quantity_requested": 5,
      "notes": "–î–ª—è –∑–∞–ª–∏–≤–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞"
    },
    {
      "material_name": "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π",
      "unit": "–º3",
      "quantity_requested": 10.5,
      "notes": ""
    }
  ]
}
```

**–û—Ç–≤–µ—Ç:** `201 Created` + –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏

---

### 4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

**PUT/PATCH** `/api/material-requests/requests/{id}/`

**–í–∞–∂–Ω–æ:** –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ (—Å—Ç–∞—Ç—É—Å `DRAFT`)!

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "project_id": 2,
  "items_data": [
    {
      "material_name": "–¶–µ–º–µ–Ω—Ç –ú500",
      "unit": "—Ç",
      "quantity_requested": 7
    }
  ]
}
```

---

### 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

**POST** `/api/material-requests/requests/{id}/submit/`

**–î–æ—Å—Ç—É–ø–Ω–æ:** –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—É –∑–∞—è–≤–∫–∏ (—Å—Ç–∞—Ç—É—Å DRAFT)

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
  "current_status": "SITE_MANAGER_APPROVAL",
  "current_approver_role": "SITE_MANAGER",
  "current_approver": "–ò–≤–∞–Ω–æ–≤ –ò.–ò."
}
```

---

### 6. –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É

**POST** `/api/material-requests/requests/{id}/approve/`

**–î–æ—Å—Ç—É–ø–Ω–æ:** –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ–≥–ª–∞—Å—É—é—â–µ–º—É

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "comment": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ –±–µ–∑ –∑–∞–º–µ—á–∞–Ω–∏–π"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞",
  "current_status": "ENGINEER_APPROVAL",
  "current_status_display": "–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ü–¢–û",
  "current_approver_role": "ENGINEER",
  "current_approver": "–ü–µ—Ç—Ä–æ–≤ –ü.–ü."
}
```

---

### 7. –í–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

**POST** `/api/material-requests/requests/{id}/reject/`

**–î–æ—Å—Ç—É–ø–Ω–æ:** –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ–≥–ª–∞—Å—É—é—â–µ–º—É

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "reason": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Ç–æ—á–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–º–µ–Ω—Ç–∞ –∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç–∞–≤–∫–µ"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ó–∞—è–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É",
  "rejection_reason": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Ç–æ—á–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ..."
}
```

---

### 8. –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—É—é

**POST** `/api/material-requests/requests/{id}/mark-paid/`

**–î–æ—Å—Ç—É–ø–Ω–æ:** –¢–æ–ª—å–∫–æ –°–Ω–∞–±–∂–µ–Ω—Ü—É (SUPPLY_MANAGER)

**–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:** `PROCUREMENT` –∏–ª–∏ `PAYMENT`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "comment": "–û–ø–ª–∞—á–µ–Ω–æ –ø–æ —Å—á—ë—Ç—É ‚Ññ12345"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ó–∞—è–≤–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω–∞—è. –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ \"–ù–∞ –¥–æ—Å—Ç–∞–≤–∫–µ\"",
  "current_status": "DELIVERY",
  "current_status_display": "–ù–∞ –¥–æ—Å—Ç–∞–≤–∫–µ"
}
```

---

### 9. –ü—Ä–∏—ë–º–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

**POST** `/api/material-requests/requests/{id}/mark-delivered/`

**–î–æ—Å—Ç—É–ø–Ω–æ:** –ú–∞—Å—Ç–µ—Ä, –ü—Ä–æ—Ä–∞–±, –ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞, –ó–∞–≤—Å–∫–ª–∞–¥ –æ–±—ä–µ–∫—Ç–∞

**–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:** `DELIVERY`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "items": [
    {
      "item_id": 1,
      "quantity_actual": 4.8
    },
    {
      "item_id": 2,
      "quantity_actual": 10.5
    }
  ],
  "comment": "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∏–Ω—è—Ç—ã, –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –Ω–µ–¥–æ—Å—Ç–∞—á–∞ –ø–æ —Ü–µ–º–µ–Ω—Ç—É"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç—ã. –ó–∞—è–≤–∫–∞ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–∞.",
  "current_status": "COMPLETED",
  "current_status_display": "–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ –∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
  "completed_at": "2024-11-11T16:00:00Z"
}
```

---

### 10. –ò—Å—Ç–æ—Ä–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

**GET** `/api/material-requests/requests/{id}/approval-history/`

**–û—Ç–≤–µ—Ç:**
```json
{
  "approval_chain": ["SITE_MANAGER", "ENGINEER", "PROJECT_MANAGER", "DIRECTOR"],
  "approval_chain_index": 3,
  "approval_history": [
    {
      "role": "SITE_MANAGER",
      "approver": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
      "decision": "approved",
      "date": "2024-11-11T11:00:00Z",
      "comment": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ"
    },
    {
      "role": "ENGINEER",
      "approver": "–ü–µ—Ç—Ä–æ–≤ –ü.–ü.",
      "decision": "approved",
      "date": "2024-11-11T12:00:00Z",
      "comment": ""
    }
  ],
  "current_approver_role": "PROJECT_MANAGER",
  "current_approver": "–°–∏–¥–æ—Ä–æ–≤ –°.–°.",
  "status": "PM_APPROVAL",
  "status_display": "–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —É –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø—Ä–æ–µ–∫—Ç–∞"
}
```

---

## –õ–æ–≥–∏–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç—Å—è —Ü–µ–ø–æ—á–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:

1. **–†–æ–ª–∏ –∞–≤—Ç–æ—Ä–∞:**
   - –ú–∞—Å—Ç–µ—Ä / –ü—Ä–æ—Ä–∞–± ‚Üí –Ω–∞—á–∞–ª–æ —Å –ù–∞—á–∞–ª—å–Ω–∏–∫–∞ —É—á–∞—Å—Ç–∫–∞
   - –ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞ ‚Üí –Ω–∞—á–∞–ª–æ —Å –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ü–¢–û

2. **–ù–∞–ª–∏—á–∏—è —Ä–æ–ª–µ–π –≤ –∫–æ–º–ø–∞–Ω–∏–∏:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —ç—Ç–∞–ø—ã, –µ—Å–ª–∏ —Ä–æ–ª–∏ –Ω–µ—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏

**–ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Ä–æ–ª–µ–π:**
```
–ú–∞—Å—Ç–µ—Ä/–ü—Ä–æ—Ä–∞–± ‚Üí –ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞ ‚Üí –ò–Ω–∂–µ–Ω–µ—Ä –ü–¢–û ‚Üí
–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –ì–ª–∞–≤–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫ ‚Üí –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä ‚Üí
–î–∏—Ä–µ–∫—Ç–æ—Ä ‚Üí –ó–∞–≤—Å–∫–ª–∞–¥ ‚Üí –°–Ω–∞–±–∂–µ–Ω–µ—Ü ‚Üí –î–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –ü—Ä–∏—ë–º–∫–∞
```

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- ‚úÖ **–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:** –¢–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ (DRAFT)
- ‚ùå **–ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:** –ó–∞—è–≤–∫–∏ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ
- üîÑ **–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É:** –°–æ–≥–ª–∞—Å—É—é—â–∏–π –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å ‚Üí —Å—Ç–∞—Ç—É—Å DRAFT ‚Üí –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑:
- üìß **Email** - –Ω–∞ –ø–æ—á—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üîî **WebSocket** - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –≤ –±—Ä–∞—É–∑–µ—Ä

**–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
1. –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
2. –ó–∞—è–≤–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞
3. –ó–∞—è–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É
4. –ó–∞—è–≤–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞
5. –ó–∞—è–≤–∫–∞ –æ–ø–ª–∞—á–µ–Ω–∞ (–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–µ)
6. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã

---

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫:
- **Superadmin:** –í—Å–µ –∑–∞—è–≤–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–∞–Ω–∏–π
- **–î–∏—Ä–µ–∫—Ç–æ—Ä, –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä:** –í—Å–µ –∑–∞—è–≤–∫–∏ —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ:** –ó–∞—è–≤–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ:
- –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏

### –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ:
- –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞

### –û–ø–ª–∞—Ç–∞:
- –¢–æ–ª—å–∫–æ –°–Ω–∞–±–∂–µ–Ω–µ—Ü (SUPPLY_MANAGER)

### –ü—Ä–∏—ë–º–∫–∞:
- –ú–∞—Å—Ç–µ—Ä, –ü—Ä–æ—Ä–∞–±, –ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞, –ó–∞–≤—Å–∫–ª–∞–¥ –æ–±—ä–µ–∫—Ç–∞

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏

```bash
# 1. –°–æ–∑–¥–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
POST /api/material-requests/requests/
{
  "project_id": 5,
  "items_data": [
    {
      "material_name": "–ö–∏—Ä–ø–∏—á –∫–µ—Ä–∞–º–∏—á–µ—Å–∫–∏–π",
      "unit": "—à—Ç",
      "quantity_requested": 5000
    }
  ]
}

# 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
POST /api/material-requests/requests/1/submit/
```

### –ü—Ä–∏–º–µ—Ä 2: –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–≥–ª–∞—Å—É—é—â–µ–≥–æ)
POST /api/material-requests/requests/1/approve/
{
  "comment": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ"
}
```

### –ü—Ä–∏–º–µ—Ä 3: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

```bash
POST /api/material-requests/requests/1/reject/
{
  "reason": "–£–∫–∞–∂–∏—Ç–µ –º–∞—Ä–∫—É –∫–∏—Ä–ø–∏—á–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"
}
```

---

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `403` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ (–Ω–µ —Ç–æ—Ç —Å–æ–≥–ª–∞—Å—É—é—â–∏–π, –Ω–µ –∞–≤—Ç–æ—Ä –∏ —Ç.–¥.)
- `404` - –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `401` - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫:**

```json
{
  "error": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∏. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –µ—ë –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É."
}
```

```json
{
  "error": "–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É. –¢–µ–∫—É—â–∏–π —Å–æ–≥–ª–∞—Å—É—é—â–∏–π: –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞"
}
```

---

## Celery Tasks (–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

1. `send_approval_notification(request_id)` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å—É—é—â–µ–º—É
2. `send_rejection_notification(request_id)` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—É –æ –≤–æ–∑–≤—Ä–∞—Ç–µ
3. `send_approved_notification(request_id)` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–ª–Ω–æ–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏
4. `send_payment_notification(request_id)` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É
5. `send_delivery_notification(request_id)` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

---

## –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ú–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∞–¥–º–∏–Ω–∫–µ: `/admin/material_requests/`

**–§—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–∫–∏:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- Inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É, –∫–æ–º–ø–∞–Ω–∏–∏, –¥–∞—Ç–µ
- –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –ø—Ä–æ–µ–∫—Ç—É, –∞–≤—Ç–æ—Ä—É

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å (—Ç–æ–ª—å–∫–æ soft delete)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∏

---

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (ER-–¥–∏–∞–≥—Ä–∞–º–º–∞)

```
MaterialRequest
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ number (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
‚îú‚îÄ‚îÄ company_id (FK ‚Üí Company)
‚îú‚îÄ‚îÄ project_id (FK ‚Üí Project, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ created_by_id (FK ‚Üí User)
‚îú‚îÄ‚îÄ status (–≤—ã–±–æ—Ä –∏–∑ 14 —Å—Ç–∞—Ç—É—Å–æ–≤)
‚îú‚îÄ‚îÄ current_approver_role (—Å—Ç—Ä–æ–∫–∞)
‚îú‚îÄ‚îÄ current_approver_id (FK ‚Üí User, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ approval_chain (JSON)
‚îú‚îÄ‚îÄ approval_history (JSON)
‚îú‚îÄ‚îÄ timestamps...
‚îî‚îÄ‚îÄ MaterialRequestItem (1-to-many)
    ‚îú‚îÄ‚îÄ id (PK)
    ‚îú‚îÄ‚îÄ request_id (FK ‚Üí MaterialRequest)
    ‚îú‚îÄ‚îÄ material_name
    ‚îú‚îÄ‚îÄ unit
    ‚îú‚îÄ‚îÄ quantity_requested
    ‚îú‚îÄ‚îÄ quantity_actual
    ‚îú‚îÄ‚îÄ notes
    ‚îî‚îÄ‚îÄ order
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Check_Site.
